import{_ as s,c as a,o as i,a4 as n}from"./chunks/framework.BzdiqRf3.js";const E=JSON.parse('{"title":"Caddy","description":"","frontmatter":{},"headers":[],"relativePath":"caddy.md","filePath":"caddy.md"}'),e={name:"caddy.md"},t=n(`<h1 id="caddy" tabindex="-1">Caddy <a class="header-anchor" href="#caddy" aria-label="Permalink to &quot;Caddy&quot;">​</a></h1><p><img src="https://user-images.githubusercontent.com/1128849/210187356-dfb7f1c5-ac2e-43aa-bb23-fc014280ae1f.svg" alt="caddy logo"></p><p>Caddy เป็น tools ตัวนึงที่ดีมากๆ หลักๆผมจะเอามาทำ reverse proxy แต่ตัว Caddy เองยังทำได้อีกหลายอย่างเลยนะ</p><p>หากเราใช้ Caddy ทำ reverse proxy เราจะได้ TLS มาโดยอัตโนมัติเลย และคอย renew certificate ให้ด้วย</p><h2 id="config-caddy-via-caddyfile" tabindex="-1">Config caddy via Caddyfile <a class="header-anchor" href="#config-caddy-via-caddyfile" aria-label="Permalink to &quot;Config caddy via Caddyfile&quot;">​</a></h2><p>เราจะต้อง config reverse proxy ผ่าน Caddyfile นะ</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">myweb.com</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	reverse_proxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kong:8000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># allow http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http://portainer.dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	reverse_proxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> portainer:9000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>จะเห็นว่าง่ายมากๆ</p><h2 id="compose-file" tabindex="-1">compose file <a class="header-anchor" href="#compose-file" aria-label="Permalink to &quot;compose file&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3.8&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  caddy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">caddy:2.7.6-alpine</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">unless-stopped</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;80:80&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;443:443&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;443:443/udp&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./Caddyfile:/etc/caddy/Caddyfile</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./caddy/site:/srv</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./caddy/caddy_data:/data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./caddy/caddy_config:/config</span></span></code></pre></div><h2 id="after-update-config-file" tabindex="-1">after update config file <a class="header-anchor" href="#after-update-config-file" aria-label="Permalink to &quot;after update config file&quot;">​</a></h2><p>เวลาแก้ config เราจะต้องสั่งให้ Caddy load config ใหม่อีกรอบนะ ก็สั่ง</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/caddy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> caddy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> caddy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span></span></code></pre></div><p>หรือ compose down แล้ว up ใหม่ก็ได้ แต่ก็จะมี downtime เพิ่มมานะ</p>`,14),p=[t];function l(h,d,k,r,c,o){return i(),a("div",null,p)}const g=s(e,[["render",l]]);export{E as __pageData,g as default};
